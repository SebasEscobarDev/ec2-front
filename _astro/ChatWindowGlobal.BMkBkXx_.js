import{j as e}from"./jsx-runtime.K1e75nIr.js";import{u as g,a as z,G as O}from"./GlobalContext.EMmJ4Qgo.js";import{b as D,a as F}from"./bg-white.CDTeDQmM.js";import{s as G,a as W}from"./instagram.BCOVGtDz.js";import{r as f}from"./index.NEDEFKed.js";import{g as A,p as R}from"./messages.5v3CQ1ja.js";import{C as P,a as Q,p as V,b as Z,c as J}from"./kimikia.BwIzljJ8.js";import{g as k,u as H}from"./consts.BQrVI9U1.js";import{s as K,C as q,H as X}from"./CardPerfilHorizontal.DLOTLxWH.js";import{s as Y}from"./img-form4.C8D0s6-p.js";import{g as ee}from"./notifies.Ccg9rzAg.js";import{s as se,M as te}from"./ModalSettings.BQceiM6T.js";/* empty css                       */import{N as re}from"./NockAlert.IFAnY8nF.js";import"./index.D7_7wx8r.js";import"./astro/assets-service.BTYAIIqN.js";import"./logo.DFUuHF2-.js";/* empty css                       */import"./users.hoqzbXOJ.js";/* empty css                       */function le(){const{userLogin:t,refDivKimik:o,refDivScrollKimik:r,messagesKimik:n,setMessagesKimik:i}=g(),s=f.useRef(null),[l,h]=f.useState(""),[u,M]=f.useState(!1);f.useEffect(()=>{x()},[n]);const x=()=>{r.current.scrollTop=r.current.scrollHeight};f.useEffect(()=>{E()},[t]);const E=async()=>{const c=await A({fromUserId:t.id,toUserId:"KimikChat"});c?.data?.rows?.length>0&&i(c.data.rows)},y=c=>{c.key==="Enter"&&j()},S=async(c,w,b)=>{let a;try{a=await R({from_user_id:c,to_user_id:w,message:b})}catch(p){console.log(p)}return a},N=async(c,w,b)=>{const a=await S(c,w,b);return i(p=>[...p,{...a?.data,type:a?.data.from_user_id===t.id?"sent":"received"}]),setTimeout(()=>{x()},100),M(!1),h(""),a},j=async()=>{if(s.current.value==="")return s.current.focus();const c=s.current.value;s.current.value="";try{const a=t.id;N(a,"KimikChat",c)}catch(a){console.log(a)}const w="KimikChat",b=t.id;try{const a=await V(c,async m=>{if(!m||m.indexOf("DONE")>-1)return;M(!0);const v=await Z(m);return await h(C=>C+v),x(),v}).then(m=>{const v=J(m);let C="";return v[0].indexOf("Error")>-1?C=v[0]:C=v.filter($=>$!==void 0).join(""),C}).catch(m=>{console.log("Error:",m),N(w,b,"Error: No hay conexion con el LLM.")});let p="";a===""?p="Error: No hay conexion con el LLM.":p=a,N(w,b,p)}catch{N(w,b,"Error al comunicarse con el LLM:")}},{bgClass3:U,bgClass4:T,borderClass:L,textClass2:_,textClass:I}=g();return e.jsxs("div",{ref:o,id:"divKimik",className:"hidden flex flex-col rigth-side w-full md:min-w-1/5 md:w-1/5 md:pl-2 transition-all",children:[e.jsx("header",{className:`bgDegreeSecondary flex items-center justify-between px-5 h-[80px] md:rounded-t-3xl md:border ${L} w-full`,children:e.jsx("h2",{className:`flex items-center text-2xl ${_} pop-semi`,children:"Kimik IA"})}),e.jsx("div",{className:`${U} relative flex flex-col overflow-hidden h-[90%] items-center w-full md:rounded-b-3xl`,children:e.jsxs("div",{ref:r,className:`flex flex-col pl-4 pr-4 mb-20 overflow-y-scroll max-h-[74vh] h-[74vh] md:max-h-[71vh] md:h-[71vh] items-center md:border ${L} border-t-0 w-full  pt-4`,children:[e.jsx(P,{messages:n,setMessages:i,userLogin:t}),u===!0&&l!=""&&e.jsx("div",{className:"flex flex-col w-full items-start",children:e.jsx(Q,{type:"received",message:l,like:!1,bgMessage:"bg-[#fda100]"})}),e.jsx("footer",{className:`absolute flex bottom-0 left-0 pb-5 pt-5 pl-5 pr-5 ${U} w-full md:rounded-b-3xl md:border-b md:border-l md:border-r ${L}`,children:e.jsxs("div",{className:"group w-full relative",children:[e.jsx("input",{ref:s,onKeyDown:y,className:`${T} focus:ring-2 focus:ring-yellow-400 focus:outline-none appearance-none w-full text-sm leading-6 ${I} placeholder-slate-300 rounded-2xl py-2 pt-3 pl-4 pr-11 ring-1 ring-slate-200 shadow-sm`,type:"text","aria-label":"Enviar Mensaje...",placeholder:"Enviar Mensaje..."}),e.jsx("button",{onClick:j,type:"button",className:"absolute right-1 top-0 px-2 py-2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"26",height:"26",fill:"currentColor",className:"bi bi-send rotate-45",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576zm6.787-8.201L1.591 6.602l4.339 2.76z"})})})]})})]})})]})}const B={src:"/_astro/kimikia.7eb-Q0QE.png",width:33,height:33,format:"png"};function ae(){const{refChatMenuLeft:t,refDivChat:o,refDivKimik:r,refDivScrollKimik:n,refHeaderButtons:i,refDivCloseKimik:s,refDivScroll:l,refBtnKimikIA:h,chatToUser:u,setChatToUser:M,userLogin:x,messages:E,setMessages:y,isMobile:S,setVentanaUser:N}=g(),j=f.useRef(null),U=()=>{o.current.classList.remove("escondido"),c(),S&&t.current.classList.add("hidden")};f.useEffect(()=>{u.id&&(T(),U())},[u]),f.useEffect(()=>{const d=k("AuthToken"),$=k("User");return d!=null&&$!=null&&L(),()=>{K.off("messageReceived"),K.disconnect()}},[]);const T=async()=>{const d=await A({fromUserId:x.id,toUserId:u.id});d?.data?.rows?.length>0&&y(d.data.rows)},L=()=>{K.connect(),K.emit("myUserId",x.id),K.on("messageReceived",async d=>{console.log("message received from server"),console.log(d),y($=>[...$,d]),c()})},_=d=>{d.key==="Enter"&&I()},I=async()=>{if(j.current.value==="")return j.current.focus();const d=await R({from_user_id:x.id,to_user_id:u.id,message:j.current.value});y([...E,{...d.data,type:d.data.from_user_id===x.id?"sent":"received"}]),j.current.value="",c()},c=()=>{setTimeout(()=>{l.current.scrollTop=l.current.scrollHeight},100)},w=()=>{setTimeout(()=>{n.current.scrollTop=n.current.scrollHeight},100)},b=async()=>{S?(N(3),o.current.classList.add("hidden")):(o.current.classList.remove("hidden"),o.current.classList.remove("md:w-4/5"),o.current.classList.add("md:w-3/5"),r.current.classList.remove("hidden"),i.current.classList.remove("w-full"),i.current.classList.add("w-4/5"),s.current.classList.remove("hidden")),r.current.classList.remove("hidden"),w()},{bgClass3:a,bgClass4:p,borderClass:m,textClass2:v,textClass:C}=g();return e.jsxs("div",{ref:o,id:"divChat",className:"escondido w-full md:flex flex-col rigth-side min-w-3/5 md:w-4/5 md:pl-2 transition-all",children:[e.jsx("header",{className:`bgDegreePrimary flex items-center justify-between px-5 h-[80px] md:rounded-t-3xl md:border ${m} w-full`,children:e.jsxs("h2",{className:`${v} flex items-center gap-4 text-2xl pop-semi`,children:[e.jsx("span",{className:`w-[50px] h-[50px] transition-all border ${m} rounded-full overflow-hidden`,children:e.jsx("span",{style:{backgroundImage:`url(${u?.foto?H+"/"+u.foto:B.src})`,backgroundSize:"100%"},width:50,alt:"Perfil",className:"inline-block w-[50px] h-[50px]"})}),u.nombre]})}),e.jsx("div",{className:`${a} relative flex flex-col overflow-hidden h-[90%] items-center w-full md:rounded-b-3xl`,children:e.jsxs("div",{ref:l,className:`flex flex-col pl-4 pr-4 mb-20 overflow-y-scroll max-h-[74vh] h-[74vh] md:max-h-[71vh] md:h-[71vh] items-center md:border ${m} border-t-0 w-full pt-4`,children:[e.jsx(P,{messages:E,setMessages:y,userLogin:x}),e.jsxs("footer",{className:`absolute flex bottom-0 left-0 pb-5 pt-5 pl-5 pr-5 ${a} w-full md:rounded-b-3xl md:border-b md:border-l md:border-r ${m}`,children:[e.jsxs("div",{className:"group w-full relative",children:[e.jsx("button",{type:"button",className:"absolute left top-0 px-2 py-2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"26",height:"26",fill:"currentColor",className:"bi bi-emoji-smile-fill",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16M7 6.5C7 7.328 6.552 8 6 8s-1-.672-1-1.5S5.448 5 6 5s1 .672 1 1.5M4.285 9.567a.5.5 0 0 1 .683.183A3.5 3.5 0 0 0 8 11.5a3.5 3.5 0 0 0 3.032-1.75.5.5 0 1 1 .866.5A4.5 4.5 0 0 1 8 12.5a4.5 4.5 0 0 1-3.898-2.25.5.5 0 0 1 .183-.683M10 8c-.552 0-1-.672-1-1.5S9.448 5 10 5s1 .672 1 1.5S10.552 8 10 8"})})}),e.jsx("input",{ref:j,onKeyDown:_,className:`focus:ring-2 ${p} focus:ring-yellow-400 focus:outline-none appearance-none w-full text-sm leading-6 ${C} placeholder-slate-300 rounded-2xl py-2 pt-3 pl-11 pr-11 ring-1 ring-slate-200 shadow-sm`,type:"text","aria-label":"Enviar Mensaje...",placeholder:"Enviar Mensaje..."}),e.jsx("button",{onClick:I,type:"button",className:"absolute right-1 top-0 px-2 py-2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"26",height:"26",fill:"currentColor",className:"bi bi-send rotate-45",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576zm6.787-8.201L1.591 6.602l4.339 2.76z"})})})]}),e.jsx("form",{className:"flex group ml-4 relative",children:e.jsx("button",{ref:h,onClick:b,id:"btnKimikIa",type:"button",className:"bg-[#3b3b3b] rounded-full items-center ring-1 px-2 ring-slate-200 shadow-sm",children:e.jsx("img",{src:B.src,width:30,alt:"Cam",className:"min-w-[30px] mt-[-2px]"})})})]})]})})]})}const oe=({user:t})=>{const{setChatToUser:o,setVentanaUser:r}=g(),n=async l=>{await o(l),r(2)},{borderClass:i,textClass:s}=g();return e.jsx("div",{className:`flex w-full border-b-2 ${i}`,children:e.jsxs("button",{type:"button",onClick:()=>n(t),className:"btn-li w-full flex justify-stretch p-2 my-2 items-center border-2 border-transparent hover:border-[#7f70cb] rounded-[25px] transition-all",children:[e.jsx("span",{className:`img-circle w-[60px] h-[50px] transition-all border ${i} rounded-full overflow-hidden`,children:e.jsx("span",{style:{backgroundImage:`url(${H}/${t.foto})`,backgroundSize:"100%"},width:50,alt:"Perfil",className:"inline-block w-[50px] h-[50px]"})}),e.jsxs("div",{className:"flex flex-col pl-2 pr-2 text-left w-4/6",children:[e.jsx("h4",{className:`${s} text-lg pop-semi h4-name`,children:e.jsx("span",{className:"h4-span",children:t?.nombre})}),e.jsx("small",{className:`${s} text-sm pop-regular`,children:t?.nacimiento_ciudad})]}),e.jsx("span",{className:`w-2/6 text-sm pop-ligth ${s} opacity-50`,children:"10:30 am."})]})})},ie=()=>{const{state:t,dispatch:o,userLogin:r}=g();f.useEffect(()=>{const s=k("AuthToken"),l=k("User");if(s!=null&&l!=null){const h=JSON.parse(l).id;if(h==null)return;n(h)}},[]);async function n(s){const l=await ee({results:20,page:1,user_id:s});l?.data?.rows?.length>0&&await o({type:z.SET_CHATS,payload:l.data.rows})}const i=t.chats?.map(s=>e.jsx(oe,{user:s},s.id));return e.jsx(e.Fragment,{children:i})},ne=()=>{const{bgClass3:t,bgClass4:o,borderClass:r,textClass:n,textClass3:i,refChatMenuLeft:s}=g();return e.jsxs("div",{id:"chatMenuLeft",ref:s,className:"flex flex-col left-side w-full md:min-w-2/5 md:w-2/5 lg:w-1/5 xl:w-1/5 md:pr-2",children:[e.jsx(q,{btnChat:!1}),e.jsxs("div",{className:`${t} h-[90vh] md:max-h-[74vh] md:h-[74vh] flex flex-col items-center px-3 py-3 md:rounded-3xl md:border ${r} w-full`,children:[e.jsx("div",{className:"mb-2 w-full",children:e.jsxs("form",{className:"group relative",children:[e.jsx("svg",{width:"20",height:"20",fill:"currentColor",className:`absolute left-3 top-1/2 -mt-2.5 ${i} pointer-events-none group-focus-within:text-yellow-400`,"aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"})}),e.jsx("input",{className:`focus:ring-2 border ${o} ${r} focus:ring-yellow-400 focus:outline-none appearance-none w-full text-sm leading-6 ${i} placeholder-slate-300 rounded-2xl py-2 pt-3 pl-10 ring-1 ring-slate-200 shadow-sm`,type:"text","aria-label":"Buscar Personas...",placeholder:"Buscar Personas..."})]})}),e.jsx("ul",{className:"flex w-full overflow-x-scroll whitespace-nowrap mt-2 pb-2 md:pb-2 xl:pb-2 mb-2",children:Array.from({length:10}).map((l,h)=>e.jsx("li",{className:`${r} ${n} flex-shrink-0 w-20 h-20 rounded-full ml-2 overflow-hidden border flex items-center justify-center`,children:e.jsx("img",{src:Y.src,width:100,alt:"Perfil",className:"w-full"})},h))}),e.jsx("h2",{className:`${r} ${n} w-full text-left pl-2 pop-semi text-2xl border-b-2 pb-2 mt-2 md:mt-2 xl:mt-4 `,children:"Chats"}),e.jsx("div",{className:"flex flex-col w-full h-[60%] md:h-[45%] xl:h-[62%] overflow-y-scroll",children:e.jsx(ie,{})})]})]})},ce=()=>{const{refDivChat:t,refDivKimik:o,refHeaderButtons:r,refDivCloseKimik:n,refBtnCloseKimik:i}=g(),s=()=>{t.current.classList.remove("md:w-3/5"),t.current.classList.add("md:w-4/5"),o.current.classList.add("hidden"),r.current.classList.add("w-full"),r.current.classList.remove("w-4/5"),n.current.classList.add("hidden")};f.useEffect(()=>{const M=k("AuthToken"),x=k("User");M!=null&&x!=null||(window.location.href="/")},[]);const{mode:l}=g(),[h,u]=f.useState(D.src);return f.useEffect(()=>{u(l==="dark"?D.src:F.src)},[l]),e.jsxs("div",{style:{backgroundColor:"white",backgroundImage:`url(${h})`},className:"flex flex-col items-start h-screen w-full min-h-screen md:p-10 bg-contain",children:[e.jsxs("div",{className:"flex w-full",children:[e.jsx(X,{id:"headerButtons",back:!0,refBtn:r}),e.jsx("div",{ref:n,id:"divCloseKimik",className:"hidden w-1/5 flex justify-end transition-all",children:e.jsx("button",{type:"button",id:"btnCloseKimik",ref:i,onClick:s,children:e.jsx("img",{src:se.src,width:45,alt:"Close"})})})]}),e.jsxs("div",{className:"w-full flex flex-col md:flex-row min-h-[85%]",children:[e.jsx(ne,{}),e.jsx(ae,{}),e.jsx(le,{})]}),e.jsxs("div",{className:"flex w-full justify-center py-2",children:[e.jsx("h4",{className:"text-white",children:"Copyright 2024"}),e.jsx("img",{src:G.src,width:20,alt:"Instagram",className:"ml-2"}),e.jsx("img",{src:W.src,width:20,alt:"Facebook",className:"ml-2"})]})]})},Ee=()=>e.jsxs(O,{children:[e.jsx(re,{}),e.jsx(te,{}),e.jsx(ce,{})]});export{Ee as default};
