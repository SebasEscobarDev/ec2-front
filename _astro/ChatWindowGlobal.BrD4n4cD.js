import{j as e}from"./jsx-runtime.K1e75nIr.js";import{u as x,a as F,G as O}from"./GlobalContext.D4cwnvuh.js";import{b as D,a as G}from"./bg-white.CDTeDQmM.js";import{s as W,a as Q}from"./instagram.BCOVGtDz.js";import{r as m}from"./index.NEDEFKed.js";import{g as A,p as R}from"./messages.D0vOhKqh.js";import{s as V,C as H,a as Z,p as q,b as J,c as X}from"./kimikiaweb.DZ-Cn6mo.js";import{g as N,u as P}from"./consts.oa5Ad7F_.js";import{s as M,C as Y,H as ee}from"./HeaderPrincipal.NQ8PjeKM.js";import{s as se}from"./img-form4.C8D0s6-p.js";import{g as te}from"./notifies.Dhv37wSu.js";import{s as re,M as le}from"./ModalSettings.Blk7gr3Q.js";/* empty css                       */import{N as ae}from"./NockAlert.C_iZTJTn.js";import"./index.D7_7wx8r.js";import"./astro/assets-service.BTYAIIqN.js";import"./logo.DFUuHF2-.js";/* empty css                       */import"./users.COxDLVda.js";/* empty css                       */const oe=()=>{const{userLogin:s,claseFristLoad:l}=x(),[r,i]=m.useState("");return m.useEffect(()=>{l||i("hidden")},[l]),e.jsx("div",{className:`${r} chat__first-load absolute px-4 bottom-0 top-0 left-0 right-0 items-center flex bg-[#1d1d1b] border-l border-r border-white justify-center`,children:e.jsxs("div",{className:"flex flex-col text-center justify-center chat__first-load__content",children:[e.jsx("span",{className:"mb-5",children:e.jsx("img",{src:V.src,width:60,className:"inline-block",alt:""})}),e.jsxs("span",{className:"bg-[#fba100] text-black p-2 rounded-lg mb-5",children:["¡Hola ",e.jsx("b",{children:s.nombre}),e.jsx("br",{}),"Soy Kimik tu asistente de IA !"]}),e.jsx("span",{className:"bg-[#fba100] text-black p-2 rounded-lg",children:"¿En qué puedo ayudarte hoy?"})]})})};function ie(){const{userLogin:s,refDivKimik:l,refDivScrollKimik:r,messagesKimik:i,setMessagesKimik:n,setClaseFristLoad:a}=x(),t=m.useRef(null),[h,u]=m.useState(""),[$,p]=m.useState(!1);m.useEffect(()=>{C()},[i]);const C=()=>{r.current.scrollTop=r.current.scrollHeight};m.useEffect(()=>{y()},[s]);const y=async()=>{const f=await A({fromUserId:s.id,toUserId:"KimikChat"});f?.data?.rows?.length>0&&n(f.data.rows)},K=f=>{f.key==="Enter"&&E()},I=async(f,w,b)=>{let c;try{c=await R({from_user_id:f,to_user_id:w,message:b})}catch(d){console.log(d)}return c},g=async(f,w,b)=>{const c=await I(f,w,b);return n(d=>[...d,{...c?.data,type:c?.data.from_user_id===s.id?"sent":"received"}]),setTimeout(()=>{C()},100),p(!1),u(""),c},E=async()=>{if(t.current.value==="")return t.current.focus();a(!1);const f=t.current.value;t.current.value="";try{const c=s.id;g(c,"KimikChat",f)}catch(c){console.log(c)}const w="KimikChat",b=s.id;try{const c=await q(f,async v=>{if(!v||v.indexOf("DONE")>-1)return;p(!0);const j=await J(v);return await u(o=>o+j),C(),j}).then(v=>{const j=X(v);let o="";return j[0].indexOf("Error")>-1?o=j[0]:o=j.filter(z=>z!==void 0).join(""),o}).catch(v=>{console.log("Error:",v),g(w,b,"Error: No hay conexion con el LLM.")});let d="";c===""?d="Error: No hay conexion con el LLM.":d=c,g(w,b,d)}catch{g(w,b,"Error al comunicarse con el LLM:")}},{bgClass3:S,bgClass4:T,borderClass:k,textClass2:_,textClass:L}=x();return e.jsxs("div",{ref:l,id:"divKimik",className:"hidden flex flex-col rigth-side w-full md:min-w-1/5 md:w-1/5 md:pl-2 transition-all",children:[e.jsx("header",{className:`bgDegreeSecondary flex items-center justify-between px-5 h-[80px] md:rounded-t-3xl md:border ${k} w-full`,children:e.jsx("h2",{className:`flex items-center text-2xl ${_} pop-semi`,children:"Kimik IA"})}),e.jsx("div",{className:`${S} relative flex flex-col overflow-hidden h-[90%] items-center w-full md:rounded-b-3xl`,children:e.jsxs("div",{ref:r,className:`flex flex-col pl-4 pr-4 mb-20 overflow-y-scroll max-h-[74vh] h-[74vh] md:max-h-[71vh] md:h-[71vh] items-center md:border ${k} border-t-0 w-full pt-4`,children:[e.jsx(oe,{}),e.jsx(H,{messages:i,setMessages:n,userLogin:s}),$===!0&&h!=""&&e.jsx("div",{className:"flex flex-col w-full items-start",children:e.jsx(Z,{type:"received",message:h,like:!1,bgMessage:"bg-[#fda100]"})}),e.jsx("footer",{className:`absolute flex bottom-0 left-0 pb-5 pt-5 pl-5 pr-5 ${S} w-full md:rounded-b-3xl md:border-b md:border-l md:border-r ${k}`,children:e.jsxs("div",{className:"group w-full relative",children:[e.jsx("input",{ref:t,onKeyDown:K,className:`${T} focus:ring-2 focus:ring-yellow-400 focus:outline-none appearance-none w-full text-sm leading-6 ${L} placeholder-slate-300 rounded-2xl py-2 pt-3 pl-4 pr-11 ring-1 ring-slate-200 shadow-sm`,type:"text","aria-label":"Enviar Mensaje...",placeholder:"Enviar Mensaje..."}),e.jsx("button",{onClick:E,type:"button",className:"absolute right-1 top-0 px-2 py-2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"26",height:"26",fill:"currentColor",className:"bi bi-send rotate-45",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576zm6.787-8.201L1.591 6.602l4.339 2.76z"})})})]})})]})})]})}const B={src:"/_astro/kimikia.7eb-Q0QE.png",width:33,height:33,format:"png"};function ne(){const{refChatMenuLeft:s,refDivChat:l,refDivKimik:r,refDivScrollKimik:i,refHeaderButtons:n,refDivCloseKimik:a,refDivScroll:t,refBtnKimikIA:h,chatToUser:u,setChatToUser:$,userLogin:p,messages:C,setMessages:y,isMobile:K,setVentanaUser:I}=x(),g=m.useRef(null),E=()=>{l.current.classList.remove("escondido"),L(),K&&s.current.classList.add("hidden")};m.useEffect(()=>{u.id&&(S(),E())},[u]),m.useEffect(()=>{const o=N("AuthToken"),U=N("User");return o!=null&&U!=null&&T(),()=>{M.off("messageReceived"),M.disconnect()}},[]);const S=async()=>{const o=await A({fromUserId:p.id,toUserId:u.id});o?.data?.rows?.length>0&&y(o.data.rows)},T=()=>{M.connect(),M.emit("myUserId",p.id),M.on("messageReceived",async o=>{console.log("message received from server"),console.log(o),y(U=>[...U,o]),L()})},k=o=>{o.key==="Enter"&&_()},_=async()=>{if(g.current.value==="")return g.current.focus();const o=await R({from_user_id:p.id,to_user_id:u.id,message:g.current.value});y([...C,{...o.data,type:o.data.from_user_id===p.id?"sent":"received"}]),g.current.value="",L()},L=()=>{setTimeout(()=>{t.current.scrollTop=t.current.scrollHeight},100)},f=()=>{setTimeout(()=>{i.current.scrollTop=i.current.scrollHeight},100)},w=async()=>{K?(I(3),l.current.classList.add("hidden")):(l.current.classList.remove("hidden"),l.current.classList.remove("md:w-4/5"),l.current.classList.add("md:w-3/5"),r.current.classList.remove("hidden"),n.current.classList.remove("w-full"),n.current.classList.add("w-4/5"),a.current.classList.remove("hidden")),r.current.classList.remove("hidden"),f()},{bgClass3:b,bgClass4:c,borderClass:d,textClass2:v,textClass:j}=x();return e.jsxs("div",{ref:l,id:"divChat",className:"escondido w-full md:flex flex-col rigth-side min-w-3/5 md:w-4/5 md:pl-2 transition-all",children:[e.jsx("header",{className:`bgDegreePrimary flex items-center justify-between px-5 h-[80px] md:rounded-t-3xl md:border ${d} w-full`,children:e.jsxs("h2",{className:`${v} flex items-center gap-4 text-2xl pop-semi`,children:[e.jsx("span",{className:`w-[50px] h-[50px] transition-all border ${d} rounded-full overflow-hidden`,children:e.jsx("span",{style:{backgroundImage:`url(${u?.foto?P+"/"+u.foto:B.src})`,backgroundSize:"100%"},width:50,alt:"Perfil",className:"inline-block w-[50px] h-[50px]"})}),u.nombre]})}),e.jsx("div",{className:`${b} relative flex flex-col overflow-hidden h-[90%] items-center w-full md:rounded-b-3xl`,children:e.jsxs("div",{ref:t,className:`flex flex-col pl-4 pr-4 mb-20 overflow-y-scroll max-h-[74vh] h-[74vh] md:max-h-[71vh] md:h-[71vh] items-center md:border ${d} border-t-0 w-full pt-4`,children:[e.jsx(H,{messages:C,setMessages:y,userLogin:p}),e.jsxs("footer",{className:`absolute flex bottom-0 left-0 pb-5 pt-5 pl-5 pr-5 ${b} w-full md:rounded-b-3xl md:border-b md:border-l md:border-r ${d}`,children:[e.jsxs("div",{className:"group w-full relative",children:[e.jsx("button",{type:"button",className:"absolute left top-0 px-2 py-2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"26",height:"26",fill:"currentColor",className:"bi bi-emoji-smile-fill",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16M7 6.5C7 7.328 6.552 8 6 8s-1-.672-1-1.5S5.448 5 6 5s1 .672 1 1.5M4.285 9.567a.5.5 0 0 1 .683.183A3.5 3.5 0 0 0 8 11.5a3.5 3.5 0 0 0 3.032-1.75.5.5 0 1 1 .866.5A4.5 4.5 0 0 1 8 12.5a4.5 4.5 0 0 1-3.898-2.25.5.5 0 0 1 .183-.683M10 8c-.552 0-1-.672-1-1.5S9.448 5 10 5s1 .672 1 1.5S10.552 8 10 8"})})}),e.jsx("input",{ref:g,onKeyDown:k,className:`focus:ring-2 ${c} focus:ring-yellow-400 focus:outline-none appearance-none w-full text-sm leading-6 ${j} placeholder-slate-300 rounded-2xl py-2 pt-3 pl-11 pr-11 ring-1 ring-slate-200 shadow-sm`,type:"text","aria-label":"Enviar Mensaje...",placeholder:"Enviar Mensaje..."}),e.jsx("button",{onClick:_,type:"button",className:"absolute right-1 top-0 px-2 py-2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"26",height:"26",fill:"currentColor",className:"bi bi-send rotate-45",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576zm6.787-8.201L1.591 6.602l4.339 2.76z"})})})]}),e.jsx("form",{className:"flex group ml-4 relative",children:e.jsx("button",{ref:h,onClick:w,id:"btnKimikIa",type:"button",className:"bg-[#3b3b3b] rounded-full items-center ring-1 px-2 ring-slate-200 shadow-sm",children:e.jsx("img",{src:B.src,width:30,alt:"Cam",className:"min-w-[30px] mt-[-2px]"})})})]})]})})]})}const ce=({user:s})=>{const{setChatToUser:l,setVentanaUser:r}=x(),i=async t=>{await l(t),r(2)},{borderClass:n,textClass:a}=x();return e.jsx("div",{className:`flex w-full border-b-2 ${n}`,children:e.jsxs("button",{type:"button",onClick:()=>i(s),className:"btn-li w-full flex p-1 my-2 items-center border-2 border-transparent hover:border-[#7f70cb] rounded-[25px] transition-all",children:[e.jsx("span",{className:`img-circle w-[50px] h-[50px] transition-all border ${n} rounded-full overflow-hidden`,children:e.jsx("span",{style:{backgroundImage:`url(${P}/${s.foto})`,backgroundSize:"100%"},width:50,alt:"Perfil",className:"flex w-[50px] h-[50px]"})}),e.jsxs("div",{className:"flex-1 flex flex-col pl-2 pr-2 text-left w-full",children:[e.jsx("h4",{className:`${a} text-lg pop-semi h4-name`,children:e.jsx("span",{className:"h4-span",children:s?.nombre})}),e.jsx("small",{className:`${a} text-sm pop-regular`,children:s?.nacimiento_ciudad})]}),e.jsx("span",{className:`text-sm pop-ligth ${a} opacity-50`,children:"10:30 am."})]})})},de=()=>{const{state:s,dispatch:l,userLogin:r}=x();m.useEffect(()=>{const a=N("AuthToken"),t=N("User");if(a!=null&&t!=null){const h=JSON.parse(t).id;if(h==null)return;i(h)}},[]);async function i(a){const t=await te({results:20,page:1,user_id:a});t?.data?.rows?.length>0&&await l({type:F.SET_CHATS,payload:t.data.rows})}const n=s.chats?.map(a=>e.jsx(ce,{user:a},a.id));return e.jsx(e.Fragment,{children:n})},me=()=>{const{bgClass3:s,bgClass4:l,borderClass:r,textClass:i,textClass3:n,refChatMenuLeft:a}=x();return e.jsxs("div",{id:"chatMenuLeft",ref:a,className:"flex flex-col left-side w-full md:min-w-2/5 md:w-2/5 lg:w-1/5 xl:w-1/5 md:pr-2",children:[e.jsx(Y,{btnChat:!1,btnNotify:!0,maxw:!0}),e.jsxs("div",{className:`${s} h-[90vh] md:max-h-[74vh] md:h-[74vh] flex flex-col items-center px-3 py-3 md:rounded-3xl md:border ${r} w-full`,children:[e.jsx("div",{className:"mb-2 w-full",children:e.jsxs("form",{className:"group relative",children:[e.jsx("svg",{width:"20",height:"20",fill:"currentColor",className:`absolute left-3 top-1/2 -mt-2.5 ${n} pointer-events-none group-focus-within:text-yellow-400`,"aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"})}),e.jsx("input",{className:`focus:ring-2 border ${l} ${r} focus:ring-yellow-400 focus:outline-none appearance-none w-full text-sm leading-6 ${n} placeholder-slate-300 rounded-2xl py-2 pt-3 pl-10 ring-1 ring-slate-200 shadow-sm`,type:"text","aria-label":"Buscar Personas...",placeholder:"Buscar Personas..."})]})}),e.jsx("ul",{className:"flex w-full overflow-x-scroll whitespace-nowrap mt-2 pb-2 md:pb-2 xl:pb-2 mb-2",children:Array.from({length:10}).map((t,h)=>e.jsx("li",{className:`${r} ${i} flex-shrink-0 w-20 h-20 rounded-full ml-2 overflow-hidden border flex items-center justify-center`,children:e.jsx("img",{src:se.src,width:100,alt:"Perfil",className:"w-full"})},h))}),e.jsx("h2",{className:`${r} ${i} w-full text-left pl-2 pop-semi text-2xl border-b-2 pb-2 mt-2 md:mt-2 xl:mt-4 `,children:"Chats"}),e.jsx("div",{className:"flex flex-col w-full h-[60%] md:h-[45%] xl:h-[62%] overflow-y-scroll",children:e.jsx(de,{})})]})]})},fe=()=>{const{refDivChat:s,refDivKimik:l,refHeaderButtons:r,refDivCloseKimik:i,refBtnCloseKimik:n}=x(),a=()=>{s.current.classList.remove("md:w-3/5"),s.current.classList.add("md:w-4/5"),l.current.classList.add("hidden"),r.current.classList.add("w-full"),r.current.classList.remove("w-4/5"),i.current.classList.add("hidden")};m.useEffect(()=>{const $=N("AuthToken"),p=N("User");$!=null&&p!=null||(window.location.href="/")},[]);const{mode:t}=x(),[h,u]=m.useState(D.src);return m.useEffect(()=>{u(t==="dark"?D.src:G.src)},[t]),e.jsxs("div",{style:{backgroundColor:"white",backgroundImage:`url(${h})`},className:"flex flex-col items-start h-screen w-full min-h-screen md:p-10 bg-contain",children:[e.jsxs("div",{className:"flex w-full",children:[e.jsx(ee,{id:"headerButtons",back:!0,refBtn:r}),e.jsx("div",{ref:i,id:"divCloseKimik",className:"hidden w-1/5 flex justify-end transition-all",children:e.jsx("button",{type:"button",id:"btnCloseKimik",ref:n,onClick:a,children:e.jsx("img",{src:re.src,width:45,alt:"Close"})})})]}),e.jsxs("div",{className:"w-full flex flex-col md:flex-row min-h-[85%]",children:[e.jsx(me,{}),e.jsx(ne,{}),e.jsx(ie,{})]}),e.jsxs("div",{className:"flex w-full justify-center py-2",children:[e.jsx("h4",{className:"text-white",children:"Copyright 2024"}),e.jsx("img",{src:W.src,width:20,alt:"Instagram",className:"ml-2"}),e.jsx("img",{src:Q.src,width:20,alt:"Facebook",className:"ml-2"})]})]})},Ue=()=>e.jsxs(O,{children:[e.jsx(ae,{}),e.jsx(le,{}),e.jsx(fe,{})]});export{Ue as default};
