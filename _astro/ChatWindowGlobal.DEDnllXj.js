const __vite__fileDeps=["_astro/web.7rxOOK1V.js","_astro/index.D7_7wx8r.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{j as e,C as O,g as N,u as T}from"./cookies.779I16bO.js";import{u as k,a as P,b as H,G as z,M as $}from"./ModalSettings.DFRVOOrG.js";import{b as F}from"./fondo.pM3xDz3j.js";import{s as J,a as G}from"./instagram.BCOVGtDz.js";import{r as f}from"./index.NEDEFKed.js";import{g as A,p as D}from"./messages.BNm5CT2K.js";import{r as W,C as Q}from"./index.D7_7wx8r.js";import{_ as V}from"./astro/assets-service.BTYAIIqN.js";import{s as M,C as Z,H as q}from"./CardPerfilHorizontal.B0_-gOTW.js";import{s as X}from"./img-form4.C8D0s6-p.js";import{g as Y}from"./notifies.dW6bY9BQ.js";/* empty css                       */import{N as ee}from"./NockAlert.BjknjXWH.js";import"./users.1oC6gPmN.js";/* empty css                       *//* empty css                       */const se={src:"/_astro/heart.CiVxwkig.svg",width:24,height:24,format:"svg"};function I({type:s,message:a,like:r,bgMessage:i}){const h=s==="received"?"flex-initial":"flex-row-reverse",o=s==="received"?"rounded-tr-[25px]":"rounded-tl-[25px]",m=s==="received"?"pr-0":"pl-15",n=i||O.bgSecondary,w=s==="sent"?"bg-white":n,g=s==="sent"?"text-black":i?"text-black":"text-white";return e.jsxs("div",{className:`flex ${h} ${m} w-full gap-2 items-center mb-4`,children:[e.jsxs("div",{className:"max-w-[40vw] text-left flex flex-col",children:[e.jsx("span",{className:`${w} ${o} py-3 px-5 ${g} border border-white rounded-b-[25px]`,children:a}),s==="sent"&&e.jsx("small",{className:"w-full text-right p-1",children:"Enviado"})]}),s==="received"&&e.jsx("button",{type:"button",children:e.jsx("img",{src:se.src,width:30,className:"min-w-[30px]",alt:"Like"})})]})}function te({text:s}){return e.jsx("div",{className:"the-time text-center p-2 w-full bg-gradient-to-b from-[#252525] rounded-xl",children:e.jsx("small",{className:"text-slate-300",children:s})})}const U=({messages:s})=>{const{userLogin:a}=k();return e.jsx(e.Fragment,{children:s&&s.map((r,i)=>e.jsxs("div",{className:"flex flex-col w-full items-start",children:[r.creado_el&&e.jsx(te,{text:r.creado_el}),e.jsx(I,{type:r.from_user_id===a.id?"sent":"received",message:r.message,like:r.like,bgMessage:r.from_user_id==="KimikChat"?"bg-[#fda100]":void 0})]},i))})},re=W("Device",{web:()=>V(()=>import("./web.7rxOOK1V.js"),__vite__mapDeps([0,1])).then(s=>new s.DeviceWeb)}),R="http://localhost:1234/v1/chat/completions";async function oe(){const s=await re.getInfo();return s.platform==="ios"||s.platform==="android"}const le=async s=>{try{return await Q.request({method:"POST",url:R,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer lm-studio"},data:{model:"model-identifier",messages:[{role:"system",content:"Te llamas Kimik, un asistente de IA útil, inteligente, amable y eficiente. Siempre cumples con las solicitudes de los usuarios de la mejor manera posible. Eres un experto psicólogo en relaciones con más de 20 años de experiencia. Siempre respondes en español de manera concisa. Sólo hablas de relaciones"},{role:"user",content:s}],temperature:.7}})}catch{return"Error al conectar con Kimik IA"}},ae=async(s,a)=>{if(await oe())return await le(s);try{const r=await fetch(R,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer lm-studio"},body:JSON.stringify({model:"model",messages:[{role:"system",content:"Te llamas Kimik, un asistente de IA útil, inteligente, amable y eficiente. Siempre cumples con las solicitudes de los usuarios de la mejor manera posible. Eres un experto psicólogo en relaciones con más de 20 años de experiencia. Siempre respondes en español de manera concisa. Sólo hablas de relaciones"},{role:"user",content:s}],temperature:.7,stream:!0})});if(!r.body)return"Error al conectar con Kimik IA";const i=r.body.getReader(),h=new TextDecoder;let o={role:"assistant",content:""};for(;;){const{done:m,value:n}=await i.read();if(m)break;const w=h.decode(n);o.content+=w,a&&a(w)}return o.content}catch(r){return console.log(r),"Error al conectar con LLM"}};function ie(){const{userLogin:s,refDivKimik:a,refDivScrollKimik:r,messagesKimik:i,setMessagesKimik:h}=k(),o=f.useRef(null),[m,n]=f.useState(""),[w,p]=f.useState(!1);f.useEffect(()=>{g()},[i]);const g=()=>{r.current.scrollTop=r.current.scrollHeight};f.useEffect(()=>{j()},[s]);const j=async()=>{const l=await A({fromUserId:s.id,toUserId:"KimikChat"});l?.data?.rows?.length>0&&h(l.data.rows)},b=l=>{l.key==="Enter"&&C()},S=async(l,u,c)=>{let t;try{t=await D({from_user_id:l,to_user_id:u,message:c})}catch(d){console.log(d)}return t},y=async(l,u,c)=>{const t=await S(l,u,c);return h(d=>[...d,{...t?.data,type:t?.data.from_user_id===s.id?"sent":"received"}]),setTimeout(()=>{g()},100),p(!1),t};function E(l){const u=typeof l!="object"?l.split(`
`):["data:"+JSON.stringify(l.data)],c=[];return u.forEach(t=>{const d=K(t);c.push(d)}),c}function K(l){if(l.trim().length>0){const c=l.trim().replace(/^data:\s*/,"").replace(/,$/,"");let t={};try{if(c==="[DONE]"||c=="")return;t=c!==void 0&&c!==""&&c.indexOf("{")>-1?JSON.parse(c):""}catch(x){console.log("Error parsing JSON:",x)}const d=t.choices&&t.choices.length>0&&t.choices[0].delta?t.choices[0].delta.content:t.choices&&t.choices.length>0&&t.choices[0].message?t.choices[0].message.content:"";return d===void 0?"":d}}const C=async()=>{if(o.current.value==="")return o.current.focus();const l=o.current.value;o.current.value="";try{const t=s.id;y(t,"KimikChat",l)}catch(t){console.log(t)}const u="KimikChat",c=s.id;try{const t=await ae(l,async x=>{if(!x||x.indexOf("DONE")>-1)return;p(!0);const v=await K(x);return await n(L=>L+v),g(),v}).then(x=>{const v=E(x);let L="";return v[0].indexOf("Error")>-1?L=v[0]:L=v.filter(B=>B!==void 0).join(""),L}).catch(x=>{console.log("Error:",x),y(u,c,"Error: No hay conexion con el LLM.")});let d="";t===""?d="Error: No hay conexion con el LLM.":d=t,y(u,c,d)}catch{y(u,c,"Error al comunicarse con el LLM:")}};return e.jsxs("div",{ref:a,id:"divKimik",className:"hidden flex flex-col rigth-side min-w-1/5 w-1/5 pl-2 transition-all",children:[e.jsx("header",{className:"bgDegreeSecondary flex items-center justify-between px-5 h-[80px] rounded-t-3xl border border-white w-full",children:e.jsx("h2",{className:"flex items-center text-2xl text-black pop-semi",children:"Kimik IA"})}),e.jsx("div",{className:"bg-[#1d1d1b] relative flex flex-col overflow-hidden h-[90%] items-center w-full rounded-b-3xl",children:e.jsxs("div",{ref:r,className:"flex flex-col pl-4 pr-4 mb-20 overflow-y-scroll max-h-[71vh] h-[100%] items-center border border-white border-t-0 w-full",children:[e.jsx(U,{messages:i,setMessages:h}),w===!0&&m!=""&&e.jsx("div",{className:"flex flex-col w-full items-start",children:e.jsx(I,{type:"received",message:m,like:!1,bgMessage:"bg-[#fda100]"})}),e.jsx("footer",{className:"absolute flex bottom-0 left-0 pb-5 pt-5 pl-5 pr-5 bg-[#1d1d1b] w-full rounded-b-3xl border-b border-l border-r border-white",children:e.jsxs("div",{className:"group w-full relative",children:[e.jsx("input",{ref:o,onKeyDown:b,className:"focus:ring-2 focus:ring-yellow-400 focus:outline-none appearance-none w-full text-sm leading-6 text-slate-300 placeholder-slate-300 rounded-2xl py-2 pt-3 pl-4 pr-11 ring-1 ring-slate-200 shadow-sm",type:"text","aria-label":"Enviar Mensaje...",placeholder:"Enviar Mensaje..."}),e.jsx("button",{onClick:C,type:"button",className:"absolute right-1 top-0 px-2 py-2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"26",height:"26",fill:"currentColor",className:"bi bi-send rotate-45",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576zm6.787-8.201L1.591 6.602l4.339 2.76z"})})})]})})]})})]})}const _={src:"/_astro/kimikia.7eb-Q0QE.png",width:33,height:33,format:"png"};function ne(){const{refDivChat:s,refDivKimik:a,refDivScrollKimik:r,refHeaderButtons:i,refDivCloseKimik:h,refDivScroll:o,refBtnKimikIA:m,chatToUser:n,setChatToUser:w,userLogin:p,messages:g,setMessages:j}=k(),b=f.useRef(null),S=()=>{s.current.classList.remove("escondido"),l()};f.useEffect(()=>{n.id&&(y(),S())},[n]),f.useEffect(()=>{const t=N("AuthToken"),d=N("User");return t!=null&&d!=null&&E(),()=>{M.off("messageReceived"),M.disconnect()}},[]);const y=async()=>{const t=await A({fromUserId:p.id,toUserId:n.id});t?.data?.rows?.length>0&&j(t.data.rows)},E=()=>{M.connect(),M.emit("myUserId",p.id),M.on("messageReceived",async t=>{console.log("message received from server"),console.log(t),j(d=>[...d,t]),l()})},K=t=>{t.key==="Enter"&&C()},C=async()=>{if(b.current.value==="")return b.current.focus();const t=await D({from_user_id:p.id,to_user_id:n.id,message:b.current.value});j([...g,{...t.data,type:t.data.from_user_id===p.id?"sent":"received"}]),b.current.value="",l()},l=()=>{setTimeout(()=>{o.current.scrollTop=o.current.scrollHeight},100)},u=()=>{setTimeout(()=>{r.current.scrollTop=r.current.scrollHeight},100)},c=async()=>{s.current.classList.remove("w-4/5"),s.current.classList.add("w-3/5"),a.current.classList.remove("hidden"),i.current.classList.remove("w-full"),i.current.classList.add("w-4/5"),h.current.classList.remove("hidden"),u()};return e.jsxs("div",{ref:s,id:"divChat",className:"escondido md:flex flex-col rigth-side min-w-3/5 w-4/5 pl-2 transition-all",children:[e.jsx("header",{className:"bgDegreePrimary flex items-center justify-between px-5 h-[80px] rounded-t-3xl border border-white w-full",children:e.jsxs("h2",{className:"flex items-center gap-4 text-2xl text-black pop-semi",children:[e.jsx("span",{className:"w-[50px] h-[50px] transition-all border border-white rounded-full overflow-hidden",children:e.jsx("span",{style:{backgroundImage:`url(${n?.foto?T+"/"+n.foto:_.src})`,backgroundSize:"100%"},width:50,alt:"Perfil",className:"inline-block w-[50px] h-[50px]"})}),n.nombre]})}),e.jsx("div",{className:"bg-[#1d1d1b] relative flex flex-col overflow-hidden h-[90%] items-center w-full rounded-b-3xl",children:e.jsxs("div",{ref:o,className:"flex flex-col pl-4 pr-4 mb-20 overflow-y-scroll max-h-[71vh] h-[100%] items-center border border-white border-t-0 w-full",children:[e.jsx(U,{messages:g,setMessages:j}),e.jsxs("footer",{className:"absolute flex bottom-0 left-0 pb-5 pt-5 pl-5 pr-5 bg-[#1d1d1b] w-full rounded-b-3xl border-b border-l border-r border-white",children:[e.jsxs("div",{className:"group w-full relative",children:[e.jsx("button",{type:"button",className:"absolute left top-0 px-2 py-2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"26",height:"26",fill:"currentColor",className:"bi bi-emoji-smile-fill",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16M7 6.5C7 7.328 6.552 8 6 8s-1-.672-1-1.5S5.448 5 6 5s1 .672 1 1.5M4.285 9.567a.5.5 0 0 1 .683.183A3.5 3.5 0 0 0 8 11.5a3.5 3.5 0 0 0 3.032-1.75.5.5 0 1 1 .866.5A4.5 4.5 0 0 1 8 12.5a4.5 4.5 0 0 1-3.898-2.25.5.5 0 0 1 .183-.683M10 8c-.552 0-1-.672-1-1.5S9.448 5 10 5s1 .672 1 1.5S10.552 8 10 8"})})}),e.jsx("input",{ref:b,onKeyDown:K,className:"focus:ring-2 focus:ring-yellow-400 focus:outline-none appearance-none w-full text-sm leading-6 text-slate-300 placeholder-slate-300 rounded-2xl py-2 pt-3 pl-11 pr-11 ring-1 ring-slate-200 shadow-sm",type:"text","aria-label":"Enviar Mensaje...",placeholder:"Enviar Mensaje..."}),e.jsx("button",{onClick:C,type:"button",className:"absolute right-1 top-0 px-2 py-2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"26",height:"26",fill:"currentColor",className:"bi bi-send rotate-45",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576zm6.787-8.201L1.591 6.602l4.339 2.76z"})})})]}),e.jsx("form",{className:"flex group ml-4 relative",children:e.jsx("button",{ref:m,onClick:c,id:"btnKimikIa",type:"button",className:"bg-[#3b3b3b] rounded-full items-center ring-1 px-2 ring-slate-200 shadow-sm",children:e.jsx("img",{src:_.src,width:30,alt:"Cam",className:"min-w-[30px] mt-[-2px]"})})})]})]})})]})}const ce=({user:s})=>{const{setChatToUser:a}=k(),r=async i=>{await a(i)};return e.jsx("div",{className:"flex w-full border-b-2 border-white",children:e.jsxs("button",{type:"button",onClick:()=>r(s),className:"btn-li w-full flex justify-stretch p-2 my-2 items-center border-2 border-[#1d1d1b] hover:border-[#7f70cb] rounded-[25px] transition-all",children:[e.jsx("span",{className:"img-circle w-[60px] h-[50px] transition-all border border-white rounded-full overflow-hidden",children:e.jsx("span",{style:{backgroundImage:`url(${T}/${s.foto})`,backgroundSize:"100%"},width:50,alt:"Perfil",className:"inline-block w-[50px] h-[50px]"})}),e.jsxs("div",{className:"flex flex-col pl-2 pr-2 text-left w-4/6",children:[e.jsx("h4",{className:"text-lg text-white pop-semi h4-name",children:e.jsx("span",{className:"h4-span",children:s?.nombre})}),e.jsx("small",{className:"text-sm text-white pop-regular",children:s?.nacimiento_ciudad})]}),e.jsx("span",{className:"w-2/6 text-sm pop-ligth",children:"10:30 am."})]})})},de=()=>{const{state:s,dispatch:a,userLogin:r}=k();f.useEffect(()=>{const o=N("AuthToken"),m=N("User");if(o!=null&&m!=null){const n=JSON.parse(m).id;if(n==null)return;console.log("init load chats"),console.log(n),i(n)}},[]);async function i(o){const m=await Y({results:20,page:1,user_id:o});m?.data?.rows?.length>0&&await a({type:P.SET_CHATS,payload:m.data.rows})}const h=s.chats?.map(o=>e.jsx(ce,{user:o},o.id));return e.jsx(e.Fragment,{children:h})},me=()=>e.jsxs("div",{className:"flex flex-col left-side min-w-[20%] w-5/5 md:w-2/5 lg:w-2/5 xl:w-1/5 pr-2",children:[e.jsx(Z,{width:"w-[10vw]",btnChat:!1}),e.jsxs("div",{className:"bg-[#1d1d1b] max-h-[74vh] h-[90%] flex flex-col items-center px-3 py-3 rounded-3xl border border-white w-full",children:[e.jsx("div",{className:"mb-2 w-full",children:e.jsxs("form",{className:"group relative",children:[e.jsx("svg",{width:"20",height:"20",fill:"currentColor",className:"absolute left-3 top-1/2 -mt-2.5 text-slate-300 pointer-events-none group-focus-within:text-yellow-400","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"})}),e.jsx("input",{className:"focus:ring-2 focus:ring-yellow-400 focus:outline-none appearance-none w-full text-sm leading-6 text-slate-300 placeholder-slate-300 rounded-2xl py-2 pt-3 pl-10 ring-1 ring-slate-200 shadow-sm",type:"text","aria-label":"Buscar Personas...",placeholder:"Buscar Personas..."})]})}),e.jsx("ul",{className:"flex w-full overflow-x-scroll whitespace-nowrap mt-2 pb-2 md:pb-2 xl:pb-2 mb-2",children:Array.from({length:10}).map((s,a)=>e.jsx("li",{className:"flex-shrink-0 w-20 h-20 rounded-full ml-2 overflow-hidden border border-white flex items-center justify-center text-white",children:e.jsx("img",{src:X.src,width:100,alt:"Perfil",className:"w-full"})},a))}),e.jsx("h2",{className:"w-full text-left pl-2 pop-semi text-2xl border-b-2 pb-2 mt-2 md:mt-2 xl:mt-4 border-white",children:"Chats"}),e.jsx("div",{className:"flex flex-col w-full h-[60%] md:h-[45%] xl:h-[62%] overflow-y-scroll",children:e.jsx(de,{})})]})]}),he=()=>{const{refDivChat:s,refDivKimik:a,refHeaderButtons:r,refDivCloseKimik:i,refBtnCloseKimik:h}=k(),o=()=>{s.current.classList.add("w-4/5"),s.current.classList.remove("w-3/5"),a.current.classList.add("hidden"),r.current.classList.add("w-full"),r.current.classList.remove("w-4/5"),i.current.classList.add("hidden")};return f.useEffect(()=>{const m=N("AuthToken"),n=N("User");m!=null&&n!=null||(window.location.href="/")},[]),e.jsxs("div",{style:{backgroundImage:`url(${F.src})`},className:"flex flex-col items-start h-screen w-full min-h-screen p-10 bg-contain",children:[e.jsxs("div",{className:"flex w-full",children:[e.jsx(q,{id:"headerButtons",back:!0,refBtn:r}),e.jsx("div",{ref:i,id:"divCloseKimik",className:"hidden w-1/5 flex justify-end transition-all",children:e.jsx("button",{type:"button",id:"btnCloseKimik",ref:h,onClick:o,children:e.jsx("img",{src:H.src,width:45,alt:"Close"})})})]}),e.jsxs("div",{className:"w-full flex min-h-[85%]",children:[e.jsx(me,{}),e.jsx(ne,{}),e.jsx(ie,{})]}),e.jsxs("div",{className:"flex w-full justify-center py-2",children:[e.jsx("h4",{className:"text-white",children:"Copyright 2024"}),e.jsx("img",{src:J.src,width:20,alt:"Instagram",className:"ml-2"}),e.jsx("img",{src:G.src,width:20,alt:"Facebook",className:"ml-2"})]})]})},Ee=()=>e.jsxs(z,{children:[e.jsx($,{}),e.jsx(ee,{}),e.jsx(he,{})]});export{Ee as default};
