import{j as e}from"./jsx-runtime.K1e75nIr.js";import{u as x,a as G,G as W}from"./GlobalContext.CWKlMZY_.js";import{b as B,a as Q}from"./bg-white.CDTeDQmM.js";import{s as V,a as Z}from"./instagram.BCOVGtDz.js";import{r as f}from"./index.NEDEFKed.js";import{g as H,p as z}from"./messages.BpCWu4kN.js";import{s as J,C as F,a as q,p as X,b as Y,c as ee}from"./kimikiaweb.Drk2x2Ao.js";import{c as u,g as L,u as P}from"./consts.D-7osD-c.js";import{s as K,C as se,H as te}from"./CardPerfilHorizontal.CxFMSiep.js";import{s as re}from"./img-form4.C8D0s6-p.js";import{g as le}from"./notifies.CkU5FzKk.js";import{s as ae,M as oe}from"./ModalSettings.DG9Rrg6C.js";/* empty css                       */import{N as ie}from"./NockAlert.B72MfmvF.js";import"./index.D7_7wx8r.js";import"./astro/assets-service.BTYAIIqN.js";import"./logo.DFUuHF2-.js";/* empty css                       */import"./users.NRaDajn1.js";/* empty css                       */const ne=()=>{const{userLogin:t,claseFristLoad:l,languageText:r}=x(),[n,a]=f.useState("");return f.useEffect(()=>{l||a("hidden")},[l]),e.jsx("div",{className:`${n} chat__first-load absolute px-4 bottom-0 top-0 left-0 right-0 items-center flex bg-[#1d1d1b] border-l border-r border-white justify-center`,children:e.jsxs("div",{className:"flex flex-col text-center justify-center chat__first-load__content",children:[e.jsx("span",{className:"mb-5",children:e.jsx("img",{src:J.src,width:60,className:"inline-block",alt:""})}),e.jsxs("span",{className:"bg-[#fba100] text-black p-2 rounded-lg mb-5",children:[u.txtChatKimik2[r]," ",e.jsx("b",{children:t.nombre}),e.jsx("br",{}),u.txtChatKimik[r]]}),e.jsx("span",{className:"bg-[#fba100] text-black p-2 rounded-lg",children:u.txtChatKimik3[r]})]})})};function ce(){const{userLogin:t,refDivKimik:l,refDivScrollKimik:r,messagesKimik:n,setMessagesKimik:a,setClaseFristLoad:o}=x(),s=f.useRef(null),[p,d]=f.useState(""),[S,g]=f.useState(!1);f.useEffect(()=>{C()},[n]);const C=()=>{r.current.scrollTop=r.current.scrollHeight};f.useEffect(()=>{M()},[t]);const M=async()=>{const h=await H({fromUserId:t.id,toUserId:"KimikChat"});h?.data?.rows?.length>0&&a(h.data.rows)},_=h=>{h.key==="Enter"&&y()},I=async(h,v,b)=>{let c;try{c=await z({from_user_id:h,to_user_id:v,message:b})}catch(m){console.log(m)}return c},N=async(h,v,b)=>{const c=await I(h,v,b);return a(m=>[...m,{...c?.data,type:c?.data.from_user_id===t.id?"sent":"received"}]),setTimeout(()=>{C()},100),g(!1),d(""),c},y=async()=>{if(s.current.value==="")return s.current.focus();o(!1);const h=s.current.value;s.current.value="";try{const c=t.id;N(c,"KimikChat",h)}catch(c){console.log(c)}const v="KimikChat",b=t.id;try{const c=await X(h,async j=>{if(!j||j.indexOf("DONE")>-1)return;g(!0);const w=await Y(j);return await d(i=>i+w),C(),w}).then(j=>{const w=ee(j);let i="";return w[0].indexOf("Error")>-1?i=w[0]:i=w.filter(O=>O!==void 0).join(""),i}).catch(j=>{console.log("Error:",j);const w=u.txtChatKimikFail[k];N(v,b,w)});let m="";c===""?m="Error: No hay conexion con el LLM.":m=c,N(v,b,m)}catch{N(v,b,"Error al comunicarse con el LLM:")}},{bgClass3:T,bgClass4:D,borderClass:$,textClass2:A,textClass:U,languageText:k}=x();return e.jsxs("div",{ref:l,id:"divKimik",className:"hidden flex flex-col rigth-side w-full md:min-w-1/5 md:w-1/5 md:pl-2 transition-all",children:[e.jsx("header",{className:`bgDegreeSecondary flex items-center justify-between px-5 h-[80px] md:rounded-t-3xl md:border ${$} w-full`,children:e.jsx("h2",{className:`flex items-center text-2xl ${A} pop-semi`,children:"Kimik IA"})}),e.jsx("div",{className:`${T} relative flex flex-col overflow-hidden h-[90%] items-center w-full md:rounded-b-3xl`,children:e.jsxs("div",{ref:r,className:`flex flex-col pl-4 pr-4 mb-20 overflow-y-scroll max-h-[74vh] h-[74vh] md:max-h-[71vh] md:h-[71vh] items-center md:border ${$} border-t-0 w-full pt-4`,children:[e.jsx(ne,{}),e.jsx(F,{messages:n,setMessages:a,userLogin:t}),S===!0&&p!=""&&e.jsx("div",{className:"flex flex-col w-full items-start",children:e.jsx(q,{type:"received",message:p,like:!1,bgMessage:"bg-[#fda100]"})}),e.jsx("footer",{className:`absolute flex bottom-0 left-0 pb-5 pt-5 pl-5 pr-5 ${T} w-full md:rounded-b-3xl md:border-b md:border-l md:border-r ${$}`,children:e.jsxs("div",{className:"group w-full relative",children:[e.jsx("input",{ref:s,onKeyDown:_,className:`${D} focus:ring-2 focus:ring-yellow-400 focus:outline-none appearance-none w-full text-sm leading-6 ${U} placeholder-slate-300 rounded-2xl py-2 pt-3 pl-4 pr-11 ring-1 ring-slate-200 shadow-sm`,type:"text","aria-label":u.txtSendMessage[k],placeholder:u.txtSendMessage[k]}),e.jsx("button",{onClick:y,type:"button",className:"absolute right-1 top-0 px-2 py-2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"26",height:"26",fill:"currentColor",className:"bi bi-send rotate-45",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576zm6.787-8.201L1.591 6.602l4.339 2.76z"})})})]})})]})})]})}const R={src:"/_astro/kimikia.7eb-Q0QE.png",width:33,height:33,format:"png"};function de(){const{refChatMenuLeft:t,refDivChat:l,refDivKimik:r,refDivScrollKimik:n,refHeaderButtons:a,refDivCloseKimik:o,refDivScroll:s,refBtnKimikIA:p,chatToUser:d,setChatToUser:S,userLogin:g,messages:C,setMessages:M,isMobile:_,setVentanaUser:I,languageText:N}=x(),y=f.useRef(null),T=()=>{l.current.classList.remove("escondido"),k(),_&&t.current.classList.add("hidden")};f.useEffect(()=>{d.id&&(D(),T())},[d]),f.useEffect(()=>{const i=L("AuthToken"),E=L("User");return i!=null&&E!=null&&$(),()=>{K.off("messageReceived"),K.disconnect()}},[]);const D=async()=>{const i=await H({fromUserId:g.id,toUserId:d.id});i?.data?.rows?.length>0&&M(i.data.rows)},$=()=>{K.connect(),K.emit("myUserId",g.id),K.on("messageReceived",async i=>{console.log("message received from server"),console.log(i),M(E=>[...E,i]),k()})},A=i=>{i.key==="Enter"&&U()},U=async()=>{if(y.current.value==="")return y.current.focus();const i=await z({from_user_id:g.id,to_user_id:d.id,message:y.current.value});M([...C,{...i.data,type:i.data.from_user_id===g.id?"sent":"received"}]),y.current.value="",k()},k=()=>{setTimeout(()=>{s.current.scrollTop=s.current.scrollHeight},100)},h=()=>{setTimeout(()=>{n.current.scrollTop=n.current.scrollHeight},100)},v=async()=>{_?(I(3),l.current.classList.add("hidden")):(l.current.classList.remove("hidden"),l.current.classList.remove("md:w-4/5"),l.current.classList.add("md:w-3/5"),r.current.classList.remove("hidden"),a.current.classList.remove("w-full"),a.current.classList.add("w-4/5"),o.current.classList.remove("hidden")),r.current.classList.remove("hidden"),h()},{bgClass3:b,bgClass4:c,borderClass:m,textClass2:j,textClass:w}=x();return e.jsxs("div",{ref:l,id:"divChat",className:"escondido w-full md:flex flex-col rigth-side min-w-3/5 md:w-4/5 md:pl-2 transition-all",children:[e.jsx("header",{className:`bgDegreePrimary flex items-center justify-between px-5 h-[80px] md:rounded-t-3xl md:border ${m} w-full`,children:e.jsxs("h2",{className:`${j} flex items-center gap-4 text-2xl pop-semi`,children:[e.jsx("span",{className:`w-[50px] h-[50px] transition-all border ${m} rounded-full overflow-hidden`,children:e.jsx("span",{style:{backgroundImage:`url(${d?.foto?P+"/"+d.foto:R.src})`,backgroundSize:"100%"},width:50,alt:"Perfil",className:"inline-block w-[50px] h-[50px]"})}),d.nombre]})}),e.jsx("div",{className:`${b} relative flex flex-col overflow-hidden h-[90%] items-center w-full md:rounded-b-3xl`,children:e.jsxs("div",{ref:s,className:`flex flex-col pl-4 pr-4 mb-20 overflow-y-scroll max-h-[74vh] h-[74vh] md:max-h-[71vh] md:h-[71vh] items-center md:border ${m} border-t-0 w-full pt-4`,children:[e.jsx(F,{messages:C,setMessages:M,userLogin:g}),e.jsxs("footer",{className:`absolute flex bottom-0 left-0 pb-5 pt-5 pl-5 pr-5 ${b} w-full md:rounded-b-3xl md:border-b md:border-l md:border-r ${m}`,children:[e.jsxs("div",{className:"group w-full relative",children:[e.jsx("button",{type:"button",className:"absolute left top-0 px-2 py-2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"26",height:"26",fill:"currentColor",className:"bi bi-emoji-smile-fill",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16M7 6.5C7 7.328 6.552 8 6 8s-1-.672-1-1.5S5.448 5 6 5s1 .672 1 1.5M4.285 9.567a.5.5 0 0 1 .683.183A3.5 3.5 0 0 0 8 11.5a3.5 3.5 0 0 0 3.032-1.75.5.5 0 1 1 .866.5A4.5 4.5 0 0 1 8 12.5a4.5 4.5 0 0 1-3.898-2.25.5.5 0 0 1 .183-.683M10 8c-.552 0-1-.672-1-1.5S9.448 5 10 5s1 .672 1 1.5S10.552 8 10 8"})})}),e.jsx("input",{ref:y,onKeyDown:A,className:`focus:ring-2 ${c} focus:ring-yellow-400 focus:outline-none appearance-none w-full text-sm leading-6 ${w} placeholder-slate-300 rounded-2xl py-2 pt-3 pl-11 pr-11 ring-1 ring-slate-200 shadow-sm`,type:"text","aria-label":u.txtSendMessage[N],placeholder:u.txtSendMessage[N]}),e.jsx("button",{onClick:U,type:"button",className:"absolute right-1 top-0 px-2 py-2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"26",height:"26",fill:"currentColor",className:"bi bi-send rotate-45",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576zm6.787-8.201L1.591 6.602l4.339 2.76z"})})})]}),e.jsx("form",{className:"flex group ml-4 relative",children:e.jsx("button",{ref:p,onClick:v,id:"btnKimikIa",type:"button",className:"bg-[#3b3b3b] rounded-full items-center ring-1 px-2 ring-slate-200 shadow-sm",children:e.jsx("img",{src:R.src,width:30,alt:"Cam",className:"min-w-[30px] mt-[-2px]"})})})]})]})})]})}const me=({user:t})=>{const{setChatToUser:l,setVentanaUser:r}=x(),n=async s=>{await l(s),r(2)},{borderClass:a,textClass:o}=x();return e.jsx("div",{className:`flex w-full border-b-2 ${a}`,children:e.jsxs("button",{type:"button",onClick:()=>n(t),className:"btn-li w-full flex p-1 my-2 items-center border-2 border-transparent hover:border-[#7f70cb] rounded-[25px] transition-all",children:[e.jsx("span",{className:`img-circle w-[50px] h-[50px] transition-all border ${a} rounded-full overflow-hidden`,children:e.jsx("span",{style:{backgroundImage:`url(${P}/${t.foto})`,backgroundSize:"100%"},width:50,alt:"Perfil",className:"flex w-[50px] h-[50px]"})}),e.jsxs("div",{className:"flex-1 flex flex-col pl-2 pr-2 text-left w-full",children:[e.jsx("h4",{className:`${o} text-lg pop-semi h4-name`,children:e.jsx("span",{className:"h4-span",children:t?.nombre})}),e.jsx("small",{className:`${o} text-sm pop-regular`,children:t?.nacimiento_ciudad})]}),e.jsx("span",{className:`text-sm pop-ligth ${o} opacity-50`,children:"10:30 am."})]})})},fe=()=>{const{state:t,dispatch:l,userLogin:r}=x();f.useEffect(()=>{const o=L("AuthToken"),s=L("User");if(o!=null&&s!=null){const p=JSON.parse(s).id;if(p==null)return;n(p)}},[]);async function n(o){const s=await le({results:20,page:1,user_id:o});s?.data?.rows?.length>0&&await l({type:G.SET_CHATS,payload:s.data.rows})}const a=t.chats?.map(o=>e.jsx(me,{user:o},o.id));return e.jsx(e.Fragment,{children:a})},he=()=>{const{bgClass3:t,bgClass4:l,borderClass:r,textClass:n,textClass3:a,refChatMenuLeft:o,languageText:s}=x();return e.jsxs("div",{id:"chatMenuLeft",ref:o,className:"flex flex-col left-side w-full md:min-w-2/5 md:w-2/5 lg:w-1/5 xl:w-1/5 md:pr-2",children:[e.jsx(se,{btnChat:!1,btnNotify:!0,maxw:!0}),e.jsxs("div",{className:`${t} h-[90vh] md:max-h-[74vh] md:h-[74vh] flex flex-col items-center px-3 py-3 md:rounded-3xl md:border ${r} w-full`,children:[e.jsx("div",{className:"mb-2 w-full",children:e.jsxs("form",{className:"group relative",children:[e.jsx("svg",{width:"20",height:"20",fill:"currentColor",className:`absolute left-3 top-1/2 -mt-2.5 ${a} pointer-events-none group-focus-within:text-yellow-400`,"aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"})}),e.jsx("input",{className:`focus:ring-2 border ${l} ${r} focus:ring-yellow-400 focus:outline-none appearance-none w-full text-sm leading-6 ${a} placeholder-slate-300 rounded-2xl py-2 pt-3 pl-10 ring-1 ring-slate-200 shadow-sm`,type:"text","aria-label":u.txtChatMenLeft[s],placeholder:u.txtChatMenLeft[s]})]})}),e.jsx("ul",{className:"flex w-full overflow-x-scroll whitespace-nowrap mt-2 pb-2 md:pb-2 xl:pb-2 mb-2",children:Array.from({length:10}).map((p,d)=>e.jsx("li",{className:`${r} ${n} flex-shrink-0 w-20 h-20 rounded-full ml-2 overflow-hidden border flex items-center justify-center`,children:e.jsx("img",{src:re.src,width:100,alt:"Perfil",className:"w-full"})},d))}),e.jsx("h2",{className:`${r} ${n} w-full text-left pl-2 pop-semi text-2xl border-b-2 pb-2 mt-2 md:mt-2 xl:mt-4 `,children:"Chats"}),e.jsx("div",{className:"flex flex-col w-full h-[60%] md:h-[45%] xl:h-[62%] overflow-y-scroll",children:e.jsx(fe,{})})]})]})},ue=()=>{const{refDivChat:t,refDivKimik:l,refHeaderButtons:r,refDivCloseKimik:n,refBtnCloseKimik:a}=x(),o=()=>{t.current.classList.remove("md:w-3/5"),t.current.classList.add("md:w-4/5"),l.current.classList.add("hidden"),r.current.classList.add("w-full"),r.current.classList.remove("w-4/5"),n.current.classList.add("hidden")};f.useEffect(()=>{const g=L("AuthToken"),C=L("User");g!=null&&C!=null||(window.location.href="/")},[]);const{mode:s,languageText:p}=x(),[d,S]=f.useState(B.src);return f.useEffect(()=>{S(s==="dark"?B.src:Q.src)},[s]),e.jsxs("div",{style:{backgroundColor:"white",backgroundImage:`url(${d})`},className:"flex flex-col items-start h-screen w-full min-h-screen md:p-10 bg-contain",children:[e.jsxs("div",{className:"flex w-full",children:[e.jsx(te,{id:"headerButtons",back:!0,refBtn:r}),e.jsx("div",{ref:n,id:"divCloseKimik",className:"hidden w-1/5 flex justify-end transition-all",children:e.jsx("button",{type:"button",id:"btnCloseKimik",ref:a,onClick:o,children:e.jsx("img",{src:ae.src,width:45,alt:"Close"})})})]}),e.jsxs("div",{className:"w-full flex flex-col md:flex-row min-h-[85%]",children:[e.jsx(he,{}),e.jsx(de,{}),e.jsx(ce,{})]}),e.jsxs("div",{className:"flex w-full justify-center py-2",children:[e.jsxs("h4",{className:"text-white",children:[u.txtCopyrigth[p]," 2024"]}),e.jsx("img",{src:V.src,width:20,alt:"Instagram",className:"ml-2"}),e.jsx("img",{src:Z.src,width:20,alt:"Facebook",className:"ml-2"})]})]})},Ie=()=>e.jsxs(W,{children:[e.jsx(ie,{}),e.jsx(oe,{}),e.jsx(ue,{})]});export{Ie as default};
