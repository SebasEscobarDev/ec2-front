import{j as e,u as S}from"./js.cookie.6G8tq96H.js";import{u as C,a as I,s as B,G as A,M as R}from"./ModalSettings.BLE-djRT.js";import{s as N,C as P,b as H,H as z}from"./CardPerfilHorizontal.CEKUvvW-.js";import{s as O,a as F}from"./instagram.BCOVGtDz.js";import{r as x}from"./index.NEDEFKed.js";import{g as U,p as T}from"./messages._g_vzTlO.js";import{C as _,a as G,p as $,b as Q,c as W}from"./kimikia.B5WuR9D4.js";import{g as y}from"./cookies.Cn3PacBg.js";import{s as Z}from"./img-form4.C8D0s6-p.js";import{g as J}from"./notifies.DGdvtSfM.js";/* empty css                       */import{N as q}from"./NockAlert.LL5dI-8E.js";import"./users.C0YN21Fa.js";import"./index.D7_7wx8r.js";import"./logo.DFUuHF2-.js";/* empty css                       */import"./astro/assets-service.BTYAIIqN.js";/* empty css                       */function V(){const{userLogin:s,refDivKimik:d,refDivScrollKimik:o,messagesKimik:n,setMessagesKimik:p}=C(),r=x.useRef(null),[c,l]=x.useState(""),[K,g]=x.useState(!1);x.useEffect(()=>{b()},[n]);const b=()=>{o.current.scrollTop=o.current.scrollHeight};x.useEffect(()=>{v()},[s]);const v=async()=>{const i=await U({fromUserId:s.id,toUserId:"KimikChat"});i?.data?.rows?.length>0&&p(i.data.rows)},w=i=>{i.key==="Enter"&&M()},L=async(i,u,m)=>{let a;try{a=await T({from_user_id:i,to_user_id:u,message:m})}catch(h){console.log(h)}return a},j=async(i,u,m)=>{const a=await L(i,u,m);return p(h=>[...h,{...a?.data,type:a?.data.from_user_id===s.id?"sent":"received"}]),setTimeout(()=>{b()},100),g(!1),l(""),a},M=async()=>{if(r.current.value==="")return r.current.focus();const i=r.current.value;r.current.value="";try{const a=s.id;j(a,"KimikChat",i)}catch(a){console.log(a)}const u="KimikChat",m=s.id;try{const a=await $(i,async t=>{if(!t||t.indexOf("DONE")>-1)return;g(!0);const f=await Q(t);return await l(k=>k+f),b(),f}).then(t=>{const f=W(t);let k="";return f[0].indexOf("Error")>-1?k=f[0]:k=f.filter(D=>D!==void 0).join(""),k}).catch(t=>{console.log("Error:",t),j(u,m,"Error: No hay conexion con el LLM.")});let h="";a===""?h="Error: No hay conexion con el LLM.":h=a,j(u,m,h)}catch{j(u,m,"Error al comunicarse con el LLM:")}};return e.jsxs("div",{ref:d,id:"divKimik",className:"hidden flex flex-col rigth-side min-w-1/5 w-1/5 pl-2 transition-all",children:[e.jsx("header",{className:"bgDegreeSecondary flex items-center justify-between px-5 h-[80px] rounded-t-3xl border border-white w-full",children:e.jsx("h2",{className:"flex items-center text-2xl text-black pop-semi",children:"Kimik IA"})}),e.jsx("div",{className:"bg-[#1d1d1b] relative flex flex-col overflow-hidden h-[90%] items-center w-full rounded-b-3xl",children:e.jsxs("div",{ref:o,className:"flex flex-col pl-4 pr-4 mb-20 overflow-y-scroll max-h-[71vh] h-[100%] items-center border border-white border-t-0 w-full  pt-4",children:[e.jsx(_,{messages:n,setMessages:p,userLogin:s}),K===!0&&c!=""&&e.jsx("div",{className:"flex flex-col w-full items-start",children:e.jsx(G,{type:"received",message:c,like:!1,bgMessage:"bg-[#fda100]"})}),e.jsx("footer",{className:"absolute flex bottom-0 left-0 pb-5 pt-5 pl-5 pr-5 bg-[#1d1d1b] w-full rounded-b-3xl border-b border-l border-r border-white",children:e.jsxs("div",{className:"group w-full relative",children:[e.jsx("input",{ref:r,onKeyDown:w,className:"focus:ring-2 bg-black focus:ring-yellow-400 focus:outline-none appearance-none w-full text-sm leading-6 text-slate-300 placeholder-slate-300 rounded-2xl py-2 pt-3 pl-4 pr-11 ring-1 ring-slate-200 shadow-sm",type:"text","aria-label":"Enviar Mensaje...",placeholder:"Enviar Mensaje..."}),e.jsx("button",{onClick:M,type:"button",className:"absolute right-1 top-0 px-2 py-2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"26",height:"26",fill:"currentColor",className:"bi bi-send rotate-45",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576zm6.787-8.201L1.591 6.602l4.339 2.76z"})})})]})})]})})]})}const E={src:"/_astro/kimikia.7eb-Q0QE.png",width:33,height:33,format:"png"};function X(){const{refDivChat:s,refDivKimik:d,refDivScrollKimik:o,refHeaderButtons:n,refDivCloseKimik:p,refDivScroll:r,refBtnKimikIA:c,chatToUser:l,setChatToUser:K,userLogin:g,messages:b,setMessages:v}=C(),w=x.useRef(null),L=()=>{s.current.classList.remove("escondido"),m()};x.useEffect(()=>{l.id&&(j(),L())},[l]),x.useEffect(()=>{const t=y("AuthToken"),f=y("User");return t!=null&&f!=null&&M(),()=>{N.off("messageReceived"),N.disconnect()}},[]);const j=async()=>{const t=await U({fromUserId:g.id,toUserId:l.id});t?.data?.rows?.length>0&&v(t.data.rows)},M=()=>{N.connect(),N.emit("myUserId",g.id),N.on("messageReceived",async t=>{console.log("message received from server"),console.log(t),v(f=>[...f,t]),m()})},i=t=>{t.key==="Enter"&&u()},u=async()=>{if(w.current.value==="")return w.current.focus();const t=await T({from_user_id:g.id,to_user_id:l.id,message:w.current.value});v([...b,{...t.data,type:t.data.from_user_id===g.id?"sent":"received"}]),w.current.value="",m()},m=()=>{setTimeout(()=>{r.current.scrollTop=r.current.scrollHeight},100)},a=()=>{setTimeout(()=>{o.current.scrollTop=o.current.scrollHeight},100)},h=async()=>{s.current.classList.remove("w-4/5"),s.current.classList.add("w-3/5"),d.current.classList.remove("hidden"),n.current.classList.remove("w-full"),n.current.classList.add("w-4/5"),p.current.classList.remove("hidden"),a()};return e.jsxs("div",{ref:s,id:"divChat",className:"escondido md:flex flex-col rigth-side min-w-3/5 w-4/5 pl-2 transition-all",children:[e.jsx("header",{className:"bgDegreePrimary flex items-center justify-between px-5 h-[80px] rounded-t-3xl border border-white w-full",children:e.jsxs("h2",{className:"flex items-center gap-4 text-2xl text-black pop-semi",children:[e.jsx("span",{className:"w-[50px] h-[50px] transition-all border border-white rounded-full overflow-hidden",children:e.jsx("span",{style:{backgroundImage:`url(${l?.foto?S+"/"+l.foto:E.src})`,backgroundSize:"100%"},width:50,alt:"Perfil",className:"inline-block w-[50px] h-[50px]"})}),l.nombre]})}),e.jsx("div",{className:"bg-[#1d1d1b] relative flex flex-col overflow-hidden h-[90%] items-center w-full rounded-b-3xl",children:e.jsxs("div",{ref:r,className:"flex flex-col pl-4 pr-4 mb-20 overflow-y-scroll max-h-[71vh] h-[100%] items-center border border-white border-t-0 w-full pt-4",children:[e.jsx(_,{messages:b,setMessages:v,userLogin:g}),e.jsxs("footer",{className:"absolute flex bottom-0 left-0 pb-5 pt-5 pl-5 pr-5 bg-[#1d1d1b] w-full rounded-b-3xl border-b border-l border-r border-white",children:[e.jsxs("div",{className:"group w-full relative",children:[e.jsx("button",{type:"button",className:"absolute left top-0 px-2 py-2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"26",height:"26",fill:"currentColor",className:"bi bi-emoji-smile-fill",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16M7 6.5C7 7.328 6.552 8 6 8s-1-.672-1-1.5S5.448 5 6 5s1 .672 1 1.5M4.285 9.567a.5.5 0 0 1 .683.183A3.5 3.5 0 0 0 8 11.5a3.5 3.5 0 0 0 3.032-1.75.5.5 0 1 1 .866.5A4.5 4.5 0 0 1 8 12.5a4.5 4.5 0 0 1-3.898-2.25.5.5 0 0 1 .183-.683M10 8c-.552 0-1-.672-1-1.5S9.448 5 10 5s1 .672 1 1.5S10.552 8 10 8"})})}),e.jsx("input",{ref:w,onKeyDown:i,className:"focus:ring-2 bg-black focus:ring-yellow-400 focus:outline-none appearance-none w-full text-sm leading-6 text-slate-300 placeholder-slate-300 rounded-2xl py-2 pt-3 pl-11 pr-11 ring-1 ring-slate-200 shadow-sm",type:"text","aria-label":"Enviar Mensaje...",placeholder:"Enviar Mensaje..."}),e.jsx("button",{onClick:u,type:"button",className:"absolute right-1 top-0 px-2 py-2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"26",height:"26",fill:"currentColor",className:"bi bi-send rotate-45",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576zm6.787-8.201L1.591 6.602l4.339 2.76z"})})})]}),e.jsx("form",{className:"flex group ml-4 relative",children:e.jsx("button",{ref:c,onClick:h,id:"btnKimikIa",type:"button",className:"bg-[#3b3b3b] rounded-full items-center ring-1 px-2 ring-slate-200 shadow-sm",children:e.jsx("img",{src:E.src,width:30,alt:"Cam",className:"min-w-[30px] mt-[-2px]"})})})]})]})})]})}const Y=({user:s})=>{const{setChatToUser:d}=C(),o=async n=>{await d(n)};return e.jsx("div",{className:"flex w-full border-b-2 border-white",children:e.jsxs("button",{type:"button",onClick:()=>o(s),className:"btn-li w-full flex justify-stretch p-2 my-2 items-center border-2 border-[#1d1d1b] hover:border-[#7f70cb] rounded-[25px] transition-all",children:[e.jsx("span",{className:"img-circle w-[60px] h-[50px] transition-all border border-white rounded-full overflow-hidden",children:e.jsx("span",{style:{backgroundImage:`url(${S}/${s.foto})`,backgroundSize:"100%"},width:50,alt:"Perfil",className:"inline-block w-[50px] h-[50px]"})}),e.jsxs("div",{className:"flex flex-col pl-2 pr-2 text-left w-4/6",children:[e.jsx("h4",{className:"text-lg text-white pop-semi h4-name",children:e.jsx("span",{className:"h4-span",children:s?.nombre})}),e.jsx("small",{className:"text-sm text-white pop-regular",children:s?.nacimiento_ciudad})]}),e.jsx("span",{className:"w-2/6 text-sm pop-ligth",children:"10:30 am."})]})})},ee=()=>{const{state:s,dispatch:d,userLogin:o}=C();x.useEffect(()=>{const r=y("AuthToken"),c=y("User");if(r!=null&&c!=null){const l=JSON.parse(c).id;if(l==null)return;console.log("init load chats"),console.log(l),n(l)}},[]);async function n(r){const c=await J({results:20,page:1,user_id:r});c?.data?.rows?.length>0&&await d({type:I.SET_CHATS,payload:c.data.rows})}const p=s.chats?.map(r=>e.jsx(Y,{user:r},r.id));return e.jsx(e.Fragment,{children:p})},se=()=>e.jsxs("div",{className:"flex flex-col left-side w-full md:min-w-[20%] md:w-2/5 lg:w-2/5 xl:w-1/5 pr-2",children:[e.jsx(P,{btnChat:!1}),e.jsxs("div",{className:"bg-[#1d1d1b] max-h-[74vh] h-[90%] flex flex-col items-center px-3 py-3 rounded-3xl border border-white w-full",children:[e.jsx("div",{className:"mb-2 w-full",children:e.jsxs("form",{className:"group relative",children:[e.jsx("svg",{width:"20",height:"20",fill:"currentColor",className:"absolute left-3 top-1/2 -mt-2.5 text-slate-300 pointer-events-none group-focus-within:text-yellow-400","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"})}),e.jsx("input",{className:"focus:ring-2 bg-black focus:ring-yellow-400 focus:outline-none appearance-none w-full text-sm leading-6 text-slate-300 placeholder-slate-300 rounded-2xl py-2 pt-3 pl-10 ring-1 ring-slate-200 shadow-sm",type:"text","aria-label":"Buscar Personas...",placeholder:"Buscar Personas..."})]})}),e.jsx("ul",{className:"flex w-full overflow-x-scroll whitespace-nowrap mt-2 pb-2 md:pb-2 xl:pb-2 mb-2",children:Array.from({length:10}).map((s,d)=>e.jsx("li",{className:"flex-shrink-0 w-20 h-20 rounded-full ml-2 overflow-hidden border border-white flex items-center justify-center text-white",children:e.jsx("img",{src:Z.src,width:100,alt:"Perfil",className:"w-full"})},d))}),e.jsx("h2",{className:"w-full text-left pl-2 pop-semi text-2xl border-b-2 pb-2 mt-2 md:mt-2 xl:mt-4 border-white text-white",children:"Chats"}),e.jsx("div",{className:"flex flex-col w-full h-[60%] md:h-[45%] xl:h-[62%] overflow-y-scroll",children:e.jsx(ee,{})})]})]}),te=()=>{const{refDivChat:s,refDivKimik:d,refHeaderButtons:o,refDivCloseKimik:n,refBtnCloseKimik:p}=C(),r=()=>{s.current.classList.add("w-4/5"),s.current.classList.remove("w-3/5"),d.current.classList.add("hidden"),o.current.classList.add("w-full"),o.current.classList.remove("w-4/5"),n.current.classList.add("hidden")};return x.useEffect(()=>{const c=y("AuthToken"),l=y("User");c!=null&&l!=null||(window.location.href="/")},[]),e.jsxs("div",{style:{backgroundImage:`url(${H.src})`},className:"flex flex-col items-start h-screen w-full min-h-screen p-4 md:p-10 bg-contain",children:[e.jsxs("div",{className:"flex w-full",children:[e.jsx(z,{id:"headerButtons",back:!0,refBtn:o}),e.jsx("div",{ref:n,id:"divCloseKimik",className:"hidden w-1/5 flex justify-end transition-all",children:e.jsx("button",{type:"button",id:"btnCloseKimik",ref:p,onClick:r,children:e.jsx("img",{src:B.src,width:45,alt:"Close"})})})]}),e.jsxs("div",{className:"w-full flex min-h-[85%]",children:[e.jsx(se,{}),e.jsx(X,{}),e.jsx(V,{})]}),e.jsxs("div",{className:"flex w-full justify-center py-2",children:[e.jsx("h4",{className:"text-white",children:"Copyright 2024"}),e.jsx("img",{src:O.src,width:20,alt:"Instagram",className:"ml-2"}),e.jsx("img",{src:F.src,width:20,alt:"Facebook",className:"ml-2"})]})]})},ye=()=>e.jsxs(A,{children:[e.jsx(R,{}),e.jsx(q,{}),e.jsx(te,{})]});export{ye as default};
